require("dotenv").config();
const { Telegraf, Markup } = require("telegraf");

// ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ð¸Ð· .env
const bot = new Telegraf(process.env.BOT_TOKEN);

// ÐœÐµÐ½ÑŽ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ (A1-B2)
const levelKeyboard = Markup.keyboard([
  ["ðŸ‡ªðŸ‡¸ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ A1", "ðŸ‡ªðŸ‡¸ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ A2"],
  ["ðŸ‡ªðŸ‡¸ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ B1", "ðŸ‡ªðŸ‡¸ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ B2"],
]).resize();

// Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ
const mainMenuKeyboard = Markup.keyboard([
  ["ðŸ° Ð¡ÐºÐ°Ð·ÐºÐ¸", "ðŸ“˜ Ð Ð°ÑÑÐºÐ°Ð·Ñ‹"],
  ["â³ Ð’Ñ€ÐµÐ¼ÐµÐ½Ð°", "â¤ï¸ Ð˜Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ"],
  ["ðŸ™ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ", "â¬…ï¸ ÐÐ°Ð·Ð°Ð´"],
]).resize();

// Ð¡Ñ‚Ð°Ñ€Ñ‚
bot.start((ctx) => {
  ctx.reply(
    `ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, ${ctx.from.first_name || "Ð´Ñ€ÑƒÐ³"}!\n\n` +
      `Ð¯ â€” Ð±Ð¾Ñ‚ *Moki* Ð´Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð¸ÑÐ¿Ð°Ð½ÑÐºÐ¾Ð³Ð¾ Ñ‡ÐµÑ€ÐµÐ· ÑÐºÐ°Ð·ÐºÐ¸ Ð¸ Ñ€Ð°ÑÑÐºÐ°Ð·Ñ‹.\n` +
      `ðŸ“– Ð§Ð¸Ñ‚Ð°Ð¹ Ð¸ ÑÐ»ÑƒÑˆÐ°Ð¹ Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾ ÑƒÑ€Ð¾Ð²Ð½ÑÐ¼ A1â€“B2.\n\n` +
      `ðŸ’– ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ /donate\n\n` +
      `Ð’Ñ‹Ð±ÐµÑ€Ð¸ ÑÐ²Ð¾Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ ðŸ‘‡`,
    {
      parse_mode: "Markdown",
      ...levelKeyboard,
    }
  );
});

// Ð’Ñ‹Ð±Ð¾Ñ€ ÑƒÑ€Ð¾Ð²Ð½Ñ
bot.hears(/Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ (A1|A2|B1|B2)/, (ctx) => {
  const level = ctx.match[1];
  ctx.session = { ...ctx.session, level };
  ctx.reply(
    `âœ… Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ ${level} Ð²Ñ‹Ð±Ñ€Ð°Ð½. ÐžÑ‚ÐºÑ€Ñ‹Ð²Ð°ÑŽ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽâ€¦`,
    mainMenuKeyboard
  );
});

// Ð—Ð°Ð³Ð»ÑƒÑˆÐºÐ¸ Ð´Ð»Ñ Ð¼ÐµÐ½ÑŽ
bot.hears("ðŸ° Ð¡ÐºÐ°Ð·ÐºÐ¸", (ctx) => ctx.reply("ðŸ“š Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÐºÐ°Ð·Ð¾Ðºâ€¦"));
bot.hears("ðŸ“˜ Ð Ð°ÑÑÐºÐ°Ð·Ñ‹", (ctx) => ctx.reply("ðŸ“– Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ€Ð°ÑÑÐºÐ°Ð·Ð¾Ð²â€¦"));
bot.hears("â³ Ð’Ñ€ÐµÐ¼ÐµÐ½Ð°", (ctx) => ctx.reply("â³ Ð’Ñ€ÐµÐ¼ÐµÐ½Ð° Ð¸ÑÐ¿Ð°Ð½ÑÐºÐ¾Ð³Ð¾ ÑÐ·Ñ‹ÐºÐ°â€¦"));
bot.hears("â¤ï¸ Ð˜Ð·Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ", (ctx) => ctx.reply("â¤ï¸ Ð¢Ð²Ð¾Ð¸ Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸â€¦"));
bot.hears("ðŸ™ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ", (ctx) => {
  ctx.reply(
    `ðŸ™ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚\n` +
      `Ð•ÑÐ»Ð¸ Ð±Ð¾Ñ‚ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ñ‚ÐµÐ±Ðµ Ð² Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¸ÑÐ¿Ð°Ð½ÑÐºÐ¾Ð³Ð¾ â€” Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸ ÐµÐ³Ð¾ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ.\n\n` +
      `ðŸ‘‰ Ð”Ð¾Ð½Ð°Ñ‚Ñ‹: https://boosty.to/yourpage`
  );
});
bot.hears("â¬…ï¸ ÐÐ°Ð·Ð°Ð´", (ctx) =>
  ctx.reply("â†©ï¸ ÐÐ°Ð·Ð°Ð´ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ", mainMenuKeyboard)
);

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch();
console.log("ðŸ¤– Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½");

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ
process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));
